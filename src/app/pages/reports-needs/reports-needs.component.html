<br>
<table>
    <tr>

        <td>
            <div class="input-group">
                <section class="example-section">
                    <mat-checkbox class="example-margin" [disabled]="checkeCustomsArea||checkeCustomsAreaAndSector"
                    
                        [(ngModel)]="checked" id="checked">بحث
                        بالقطاعات والادارات المركزية والادارات العامة</mat-checkbox>
                </section>
            </div>

        </td>
    </tr>
    <tr>

        <td>
            <div class="input-group">
                <section class="example-section">
                    <mat-checkbox class="example-margin" [disabled]="checked||checkeCustomsAreaAndSector" id="checkeCustomsArea"
                  [(ngModel)]="checkeCustomsArea">بحث
                        بالمنطقة الجمركية</mat-checkbox>
                </section>
            </div>

        </td>
    </tr>

    <tr>

        <td>
            <div class="input-group">
                <section class="example-section">
                    <mat-checkbox class="example-margin" [disabled]="checked||checkeCustomsArea" id="checkeCustomsAreaAndSector"
                     [(ngModel)]="checkeCustomsAreaAndSector">بحث
                        بالمنطقة والقطاع</mat-checkbox>
                </section>
            </div>

        </td>
    </tr>
</table>
<form [formGroup]="orderNeedsForm" *ngIf="orderNeedsForm" class="normal-form" dir="rtl" (submit)="onSubmit()"
    (keydown.enter)="$event.preventDefault()">

    <table>
        <tr *ngIf="checkeCustomsArea">
            <td>
                <label style="margin: 0px 20px;"> المنطقة الجمركية</label>

            </td>
            <td>
                <div class="input-group">
                    <ng-select [items]="areasArray" formControlName="CustomsArea" bindLabel="name" bindValue="id"
                        (change)="onchangeCustomsAreas($event)" placeholder="Select Section"
                        style="width: 300px; margin: 0px 20px;">
                    </ng-select>
                    <button type="button" *ngIf=" CustomsAreaId != null"
                        (click)="GetdevicesNeedsForSectorCenters(CustomsAreaId,2)">عرض
                    </button>
                </div>
            </td>
        </tr>

        <tr *ngIf="checked">
            <td style="width: 120px;">
                <label style="margin: 0px 20px;">القطاع</label>
            </td>
            <td>
                <div class="input-group">
                    <ng-select [items]="sections" formControlName="SectionId" bindLabel="name" bindValue="id"
                        (change)="onchangeSections($event)" placeholder="Select Section"
                        style="width: 300px; margin: 0px 20px;">
                    </ng-select>
                    <button type="button" *ngIf=" sectorID != null"
                        (click)="GetdevicesNeedsForSectorCenters(sectorID,1)">عرض
                    </button>
                </div>

            </td>
        </tr>
        <ng-container *ngIf="centersList != null">

            <tr *ngIf="checked">
                <td>
                    <label style="margin: 0px 20px;">الإدارة المركزية</label>
                </td>
                <td>
                    <div class="input-group">
                        <ng-select formControlName="Centers" bindLabel="name" bindValue="ID"
                            (change)="onchangeCenters($event)" placeholder=" اختر إدارة مركزية"
                            style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let center of centersList" [(value)]="center.ID">{{center.name}}
                            </ng-option>
                        </ng-select>
                        <button type="button" *ngIf="centerID != null"
                            (click)="GetdevicesNeedsForSectorCenters(centerID,3)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container>
        <ng-container *ngIf="ManagmentsList != null ">

            <tr *ngIf="checked">
                <td>
                    <label style="margin: 0px 20px;">الإدارة العامة</label>
                </td>
                <td>
                    <div class="input-group">

                        <ng-select *ngIf="ManagmentsList != null" formControlName="Managment" bindLabel="name"
                            bindValue="ID" (change)="onchangeManagments($event)" placeholder=" اختر إدارة عامة"
                            style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let Managment of ManagmentsList" [(value)]="Managment.mang">
                                {{Managment.name}}</ng-option>
                        </ng-select>
                        <button type="button" *ngIf="ManagmentID != null"
                            (click)="GetdevicesNeedsForSectorCenters(ManagmentID,4)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container>
        <ng-container *ngIf="Managments2List != null && Managments2List.length > 0">

            <tr>
                <td>
                    <label style="margin: 0px 20px;">إدارة تحت التابعة</label>
                </td>
                <td>
                    <div class="input-group" [ngClass]="showSections()">

                        <ng-select *ngIf="Managments2List != null" formControlName="Managment2" bindLabel="name"
                            bindValue="ID" (change)="onchangemanagments2($event)" placeholder=" اختر إدارة تحت التابعة"
                            style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let Managment of Managments2List" [(value)]="Managment.ID">
                                {{Managment.name}}</ng-option>
                        </ng-select>
                        <button type="button" *ngIf="Managment2ID != null"
                            (click)="showManagmentDevices(Managment2ID)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container>
    </table>
    <table>
        <tr *ngIf="checkeCustomsAreaAndSector">
            <td>
                <label style="margin: 0px 20px;"> المنطقة الجمركية</label>

            </td>
            <td>
                <div class="input-group">
                    <ng-select [items]="areasArray" formControlName="CustomsAreaForTwoOptions" bindLabel="name"
                        bindValue="id" (change)="onchangeCustomsAreas($event)" placeholder="Select Section"
                        style="width: 300px; margin: 0px 20px;">
                    </ng-select>
                    <!-- <button type="button" *ngIf=" !checkeCustomsAreaAndSector"
                        (click)="GetdevicesNeedsForSectorCenters(CustomsAreaId,2)">عرض
                    </button> -->
                </div>
            </td>
        </tr>

        <tr *ngIf="checkeCustomsAreaAndSector">
            <td style="width: 120px;">
                <label style="margin: 0px 20px;">القطاع</label>
            </td>
            <td>
                <div class="input-group">
                    <ng-select [items]="sections" formControlName="SectionIdForTwoOptions" bindLabel="name"
                        bindValue="id" (change)="onchangeSections($event)" placeholder="Select Section"
                        style="width: 300px; margin: 0px 20px;">
                    </ng-select>
                    <button type="button" *ngIf=" sectorID != null"
                        (click)="GetdevicesNeedsForSectorCentersAndCustomsArea(sectorID,1,CustomsAreaId)">عرض
                    </button>
                </div>

            </td>
        </tr>
        <ng-container *ngIf="centersList != null">

            <tr *ngIf="checkeCustomsAreaAndSector">
                <td>
                    <label style="margin: 0px 20px;">الإدارة المركزية</label>
                </td>
                <td>
                    <div class="input-group">
                        <ng-select formControlName="CentersForTwoOptions" bindLabel="name" bindValue="ID"
                            (change)="onchangeCenters($event)" placeholder=" اختر إدارة مركزية"
                            style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let center of centersList" [(value)]="center.ID">{{center.name}}
                            </ng-option>
                        </ng-select>
                        <button type="button" *ngIf="centerID != null"
                            (click)="GetdevicesNeedsForSectorCentersAndCustomsArea(centerID,3,CustomsAreaId)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container>
        <ng-container *ngIf="ManagmentsList != null ">

            <tr *ngIf="checkeCustomsAreaAndSector">
                <td>
                    <label style="margin: 0px 20px;">الإدارة العامة</label>
                </td>
                <td>
                    <div class="input-group">

                        <ng-select *ngIf="ManagmentsList != null" formControlName="ManagmentForTwoOptions"
                            bindLabel="name" bindValue="ID" (change)="onchangeManagments($event)"
                            placeholder=" اختر إدارة عامة" style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let Managment of ManagmentsList" [(value)]="Managment.mang">
                                {{Managment.name}}</ng-option>
                        </ng-select>
                        <button type="button" *ngIf="ManagmentID != null"
                            (click)="GetdevicesNeedsForSectorCentersAndCustomsArea(ManagmentID,4,CustomsAreaId)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container>
        <!-- <ng-container *ngIf="Managments2List != null && Managments2List.length > 0">

            <tr>
                <td>
                    <label style="margin: 0px 20px;">إدارة تحت التابعة</label>
                </td>
                <td>
                    <div class="input-group" [ngClass]="showSections()">

                        <ng-select *ngIf="Managments2List != null" formControlName="Managment2" bindLabel="name"
                            bindValue="ID" (change)="onchangemanagments2($event)" placeholder=" اختر إدارة تحت التابعة"
                            style="width: 300px; margin: 0px 20px;">
                            <ng-option *ngFor="let Managment of Managments2List" [(value)]="Managment.ID">
                                {{Managment.name}}</ng-option>
                        </ng-select>
                        <button type="button" *ngIf="Managment2ID != null"
                            (click)="showManagmentDevices(Managment2ID)">عرض
                        </button>
                    </div>
                </td>
            </tr>
        </ng-container> -->
    </table>
</form>

<div class="button-box">
    <div class="button-row">
        <button printSectionId="print-section" mat-raised-button color="primary" type="button"
            *ngIf="listData != null && listData.length > 0" ngxPrint>طباعة</button>
    </div>
</div>
<div class="mat-elevation-z8" [ngClass]="{'hide':!isSearched}" id="print-section">
    <mat-toolbar style="text-align: center;">
        <ng-container [ngSwitch]="type" *ngIf="isSearched && listData.length > 0">
            <span class="example-fill-remaining-space"></span>
            <span class="example-fill-remaining-space"></span>
            <span *ngSwitchCase="1" style="direction: ltr;"> تقرير الاحتياجات بـ {{sections[sectorID-1].name}}
            </span>
            <span *ngSwitchCase="2"> تقرير الاحتياجات بالمنطقة({{areasArray[CustomsAreaId-1].name}})</span>
            <span *ngSwitchCase="3"> تقرير الاحتياجات بـ{{centersList[centerID-1].name}}</span>
            <span *ngSwitchCase="4"> تقرير الاحتياجات بـ{{ManagmentsList[ManagmentID-1].name}}</span>

            <span class="example-fill-remaining-space"></span>
            <span class="example-fill-remaining-space"></span>
        </ng-container>

        <ng-container *ngIf="isSearched && listData.length == 0">
            <span class="example-fill-remaining-space"></span>
            <span class="example-fill-remaining-space"></span>

            <span> لا يوجد نتائج للبحث </span>
            <span class="example-fill-remaining-space"></span>
            <span class="example-fill-remaining-space"></span>
        </ng-container>
    </mat-toolbar>

    <table class="table table-striped  table-hover table-border" cellspacing="0"
        *ngIf="listData != null && listData.length > 0" dir="rtl">
        <thead class="thead-dark">
            <th style="text-align: center;border: 1px solid black">م</th>
            <th style="text-align: center;border: 1px solid black;width: 200px;">الادارة</th>
            <th style="text-align: center;border: 1px solid black">الاحتياجات</th>
            <th style="text-align: center;border: 1px solid black">الأجهزة المصروفة</th>

            <th style="text-align: center;border: 1px solid black">الأجهزة الموجودة بالإدارة</th>

            <th style="text-align: center;border: 1px solid black">المنطقة الجمركية</th>
        </thead>
        <tbody>

            <tr *ngFor="let item of listData;let i=index;" style="text-align: right; ">
                <td style="border: 1px solid black">{{i+1}}</td>
                <td style="border: 1px solid black"><a
                        style="text-decoration: none;color: black;width: 150px;text-align: right;"
                        rowspan=listData[i].OrderNeeds.length> {{item.Structure}} </a>
                </td>

                <td style="text-align: right;border: 1px solid black;margin: 0px;width:min-content;">
                    <ul *ngFor="let item1 of listData[i].OrderNeeds ; let j=index">
                        {{this.datepipe.transform(item1.OrderDate|date , 'yyyy-MM-dd')}}
                        <li *ngFor="let item1 of listData[i].OrderNeeds[j].OrderItems"><span> {{item1.NumberOf}}
                            </span>
                            <span [ngSwitch]="item1.Type">
                                <span *ngSwitchCase="1"> كمبيوتر</span>
                                <span *ngSwitchCase="2">طابعة</span>
                                <span *ngSwitchCase="3">ماكينة تصوير</span>
                                <span *ngSwitchCase="4">ماسح ضوئي</span>
                                <span *ngSwitchCase="5"> فاكس</span>
                                <span *ngSwitchCase="6">شاشة</span>
                                <span *ngSwitchCase="7">أخرى</span>
                            </span>
                        </li>
                    </ul>

                    <!-- <table>
                        <tr style="text-align: center;border: 1px solid black;margin: 0px;width:min-content;"
                            *ngFor="let item1 of listData[i].OrderNeeds ; let j=index">

                            <td style="text-align: center;border: 1px solid black;margin: 0px;width:min-content;">
                                {{item1.OrderDate}}</td>


                            <td style="text-align: center;border: 1px solid black;margin: 0px;width:min-content;"
                                *ngFor="let item1 of listData[i].OrderNeeds[j].OrderItems"><span> {{item1.NumberOf}}
                                </span>
                                <span [ngSwitch]="item1.Type">
                                    <span *ngSwitchCase="1"> كمبيوتر</span>
                                    <span *ngSwitchCase="2">طابعة</span>
                                    <span *ngSwitchCase="3">ماكينة تصوير</span>
                                    <span *ngSwitchCase="4">ماسح ضوئي</span>
                                    <span *ngSwitchCase="5"> فاكس</span>
                                    <span *ngSwitchCase="6">شاشة</span>
                                    <span *ngSwitchCase="7">أخرى</span>
                                </span>
                            </td>
                        </tr>
                    </table> -->


                </td>


                <td style="text-align: right;border: 1px solid black;margin: 0px;width:min-content;">
                    <ul *ngFor="let item2 of listData[i].OrderNeeds ; let j=index">
                        <span> {{this.datepipe.transform(item2.OrderDate|date , 'yyyy-MM-dd')}}</span>
                        <ng-container>
                            <ul *ngFor="let item1 of listData[i].OrderNeeds[j].OrderItems ; let c=index">
                                <li *ngFor="let item1 of listData[i].OrderNeeds[j].OrderItems[c].achievements">
                                    <ng-container *ngIf="listData[i].OrderNeeds[j].OrderItems[c].achievements!=null">

                                        <span> {{item1.NumberOf}}
                                        </span>
                                        <span [ngSwitch]="item1.AchievementDeviceType">
                                            <span *ngSwitchCase="1"> كمبيوتر</span>
                                            <span *ngSwitchCase="2">طابعة</span>
                                            <span *ngSwitchCase="3">ماكينة تصوير</span>
                                            <span *ngSwitchCase="4">ماسح ضوئي</span>
                                            <span *ngSwitchCase="5"> فاكس</span>
                                            <span *ngSwitchCase="6">شاشة</span>
                                            <span *ngSwitchCase="7">أخرى</span>
                                        </span>

                                    </ng-container>
                                    <ng-container
                                        *ngIf="listData[i].OrderNeeds[j].OrderItems[c].achievements.length==0">لا
                                        يوجد أجهزة منصرفة</ng-container>
                                </li>

                            </ul>
                        </ng-container>

                    </ul>
                </td>

                <td style="border: 1px solid black">
                    <ul>
                        <li *ngFor="let item1 of listData[i].Devices3s; let j=index"><span> {{item1.cod}} |

                                {{item1.deviceid}}|{{item1.devicemodel}}|{{item1.devicemark}}|
                                عدد {{item1.numberofprinter}}|
                                <span [ngSwitch]="item1.model">
                                    <span *ngSwitchCase="1"> كمبيوتر</span>
                                    <span *ngSwitchCase="2">طابعة</span>
                                    <span *ngSwitchCase="3">ماكينة تصوير</span>
                                    <span *ngSwitchCase="4">ماسح ضوئي</span>
                                    <span *ngSwitchCase="5"> فاكس</span>
                                    <span *ngSwitchCase="6">شاشة</span>
                                    <span *ngSwitchCase="7">أخرى</span>
                                </span>|
                                <span [ngSwitch]="item1.printercase">
                                    <span *ngSwitchCase="1"> يعمل جديد</span>
                                    <span *ngSwitchCase="2">لا يعمل جديد</span>
                                    <span *ngSwitchCase="3">يعمل قديم</span>
                                    <span *ngSwitchCase="4">لا يعمل قديم</span>
                                </span>




                                |{{this.datepipe.transform(item1.devicedate|date , 'yyyy-MM-dd')}}
                            </span>
                        </li>
                    </ul>
                </td>


                <td style="border: 1px solid black">
                    <ng-container *ngIf="item.CustomsArea == 1"> شمالية و غربية</ng-container>
                    <ng-container *ngIf="item.CustomsArea == 2 "> وسطى و جنوبية</ng-container>
                    <ng-container *ngIf="item.CustomsArea == 3 "> شرقية</ng-container>
                </td>
            </tr>
        </tbody>
    </table>
    <br>
</div>